<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="deptMapper">
 <resultMap type="kh.study.emp.dept.vo.DeptVO" id="dept">
	<id column="DEPT_NO" property="deptNo"/>
	<result column="DEPT_NAME" property="deptName"/>
	<result column="LOC" property="loc"/>
</resultMap> 

<!--목록조회 -->
<select id="selectDept" resultMap="dept">
SELECT DEPT_NO
, DEPT_NAME
, LOC
FROM TEST_DEPARTMENT
ORDER BY DEPT_NO
</select> 

<!-- 부서등록 -->
<!-- 1씩증가하는 다음 dept_no조회하기 dept001,dept002... -->
<!-- 실제로 내가 insert하기전에 selectKey를 먼저 조회 후
     string 문자열 자료형으로 이름은 keyProperty값으로 데리고 와서 사용하는데 순서를 쿼리실행 전 먼저 셀렉트키를 실행한다. -->
<insert id="insetDept">
	<selectKey resultType="String" keyProperty="deptNo" order="BEFORE">
		SELECT 'DEPT' || TO_CHAR(LPAD(NVL(MAX(TO_NUMBER(SUBSTR(DEPT_NO,5))),0)+1,3,'0'))
 		FROM TEST_DEPARTMENT	
	</selectKey>
	INSERT INTO TEST_DEPARTMENT (
		DEPT_NO
		, DEPT_NAME
		, LOC
	) VALUES (
		#{deptNo}
		, #{deptName}
		, #{loc}
	)
</insert>
</mapper>